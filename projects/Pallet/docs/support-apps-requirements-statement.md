# 【改修版】業務支援アプリケーション 要件定義書

**文書バージョン:** 4.0
**作成日:** 2025年4月9日
**最終更新日:** 2025年4月9日
**作成者:** (担当者名/部署名)/Gemini
**承認者:** (承認者名/役職)

**改訂履歴**

| バージョン | 更新日     | 更新者             | 更新内容                                                                                                                               |
| :--------- | :--------- | :----------------- | :------------------------------------------------------------------------------------------------------------------------------------- |
| 1.0        | 2025-MM-DD | (担当者名)         | 初版作成                                                                                                                               |
| 2.0        | 2025-MM-DD | (担当者名)         | Accessへの限定、新データフロー、一部機能廃止を反映                                                                                       |
| 3.0        | 2025-04-09 | (担当者名)/Gemini  | 「7. 方針決定事項および今後の検討事項」に決定事項・方針を具体的に反映                                                                        |
| 4.0        | 2025-04-09 | (担当者名)/Gemini  | 標準ドキュメント群、デザイン参照用CSSの内容を反映し、全体的な具体性・詳細度を向上。特にエラーハンドリング、アクセシビリティ要件を強化。表記統一（障害者）。 |

---

## 1. はじめに

### 1.1 文書の目的

本書は、顧客個人情報を含むExcelファイル（以下、顧客Excel管理表）への直接入力に伴う業務の煩雑化、入力ミス、作業漏れ、およびファイル破損リスクを軽減し、業務効率と作業品質の向上を目的とした業務支援アプリケーション（以下、本システム）の開発における要件を定義するものです。

本書は、開発関係者間の共通理解を形成し、**【標準ドキュメント群】**（AI開発者向けガイド、コーディング規約、設計原則とパターン、テスト戦略とガイドライン）と共に、開発作業の基礎資料とすることを目的とします。

### 1.2 システム開発の背景と課題

現在、業務において以下の課題が存在します。

1.  **巨大かつ管理されていない顧客Excel管理表の存在:**
    * 個人情報が含まれるため、社外への持ち出しやクラウド利用が制限されています。
    * テーブル構造や入力規則（バリデーション）が未整備のまま運用されており、顧客自身によるランダムな行の追加・削除・修正が発生しうる状況です。
    * 複数メンバーによる顧客Excel管理表への直接入力・同時編集が行われており、入力ミス、データの不整合、ファイル破損が頻発しています。
2.  **業務証跡管理とデータ追跡の困難さ:**
    * 「誰が」「どの案件に対し」「いつ作業を開始し完了したか」を正確に記録・追跡する必要があります。
    * しかし、顧客Excel管理表のキー情報（顧客IDや行番号など）が変動する可能性があり、作業履歴と案件情報の安定的な紐づけ（リレーション維持）が困難です。
3.  **作業負荷とアクセシビリティの問題:**
    * 雑多な顧客Excel管理表を直接操作（フィルタリング、スクロール、目視照合）することは、特に**障害**を持つメンバーにとって大きな負担となり、ヒューマンエラーを誘発しやすい状況です。ユニバーサルデザインへの配慮が求められます。
4.  **複数メンバー利用とリモートワーク環境への対応:**
    * 共有フォルダ等でのExcelファイル同時利用における排他制御が不十分であり、データの競合や上書きが発生するリスクがあります。
    * リモートワーク環境下でのネットワーク不安定性も考慮する必要があります。
5.  **書類照合作業の効率化:**
    * 紙媒体やPDF形式の書類と顧客Excel管理表の内容を照合する作業が頻繁に発生しており、より効率的でミスの少ない方法が求められています。

### 1.3 システム導入の目的

本システムの導入により、以下の実現を目指します。

* **入力ミス・作業漏れ・データ破損の削減:** 顧客Excel管理表への直接入力を廃止し、本システム（Microsoft Access）を介した統制されたプロセスに変更することで、ヒューマンエラーとファイル破損リスクを大幅に削減します。
* **作業証跡の確実な記録:** システム独自のキー管理とログ機能により、「誰が」「何を」「いつ」行ったかの証跡を確実に記録・追跡可能にします。
* **作業品質と効率の向上:** 標準化された入力フォームとデータ処理フローにより、作業品質のばらつきを抑制し、業務効率を向上させます。
* **ユニバーサルデザインの実現:** Accessフォームの機能を活用し、**障害**者を含む多様なメンバーが利用しやすい操作性（アクセシビリティ）を提供します（詳細は 5.4項 参照）。
* **データ整合性の確保:** バリデーション機能や統制されたデータ更新プロセスにより、データの整合性を維持します。
* **保守性とテスト容易性の向上:** **【設計原則とパターン (VBA版)】** に基づく設計（FE/BE分離、クラスモジュールの活用、依存性注入の考慮など）により、将来的な保守や機能追加、テストを容易にします。

---

## 2. 用語定義

| 用語                | 定義                                                                                                                                                                                                     |
| :------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **顧客Excel管理表** | 既存の顧客情報管理Excelファイル。個人情報を含み、社内保管。本システムでは原則として直接編集せず、データ取込元および転記先となる原本。                                                                                         |
| **コピーExcel管理表** | 業務開始時に「顧客Excel管理表」を複製したもの。本システムへのデータ取込元ファイルとして使用する。                                                                                                                     |
| **メンバー** | 本システムを利用して実作業（データ取込、入力、照合、書き戻し指示等）を行うユーザー。**障害**者を含む。                                                                                                                     |
| **管理者** | 本システムの運用管理、設定変更、トラブルシューティング、バックアップ管理等を担当する担当者。                                                                                                                   |
| **本システム** | 本要件定義書に基づきMicrosoft Accessで構築される業務支援アプリケーション全体（フロントエンド、バックエンドDBを含む）。                                                                                             |
| **フロントエンド(FE)** | 本システムのユーザーインターフェース部分。Accessフォーム、レポート、およびそれらを制御するVBAコード、UIロジック等で構成される。各メンバーPCで利用。                                                                            |
| **バックエンド(BE)** | 本システムのデータ格納部分。Accessデータベースファイル(.accdb)内に構築されるテーブル、クエリ、リレーションシップ、データアクセスロジック（必要に応じて）等を含む。共有フォルダ等で一元管理。                                                 |
| **ステージングDB** | バックエンドDB内に作成されるテーブル群。コピーExcel管理表からインポートしたデータを一時的に格納し、メンバーが作業を行うための領域。データの整合性維持、作業中の元データ保護を目的とする。                                                              |
| **独自キー** | 本システムが案件データや作業履歴データに内部的に付与する一意の識別子。顧客Excel管理表上のキー変動の影響を受けずにリレーションを維持するために使用。通常はオートナンバー型やユニークな複合キーで実装。                                              |
| **リレーション** | ステージングDB内のテーブル間（例: 案件情報と作業履歴）を、独自キー等を用いて関連付けること。Accessのリレーションシップ機能やクエリで実装し、データの整合性を確保する。                                                                          |
| **ユニバーサルデザイン** | 年齢、能力、状況等に関わらず、できる限り多くの人が利用可能であることを目指した設計思想。本システムではUI/UX設計において**【デザイン参照用CSS】**の思想を参考に配慮する。                                                              |
| **アクセシビリティ** | **障害**者や高齢者を含む、多様なユーザーが情報や機能に容易にアクセスし、利用できる度合い。本システムでは特に操作性に関する非機能要件（5.4項）として重視する。                                                                     |
| **VBA** | Microsoft Visual Basic for Applications。本システムの開発に使用するプログラミング言語。開発は**【標準ドキュメント群】**に準拠する。                                                                                   |
| **エラーハンドリング** | プログラム実行中に発生する予期せぬエラー（ファイルアクセス失敗、データ型不一致等）を検知し、適切に対応する仕組み。**【設計原則とパターン (VBA版)】** の戦略に基づき実装する。                                                             |
| **ログ** | システムの動作状況、エラー発生、データ処理結果などを記録した情報。トラブルシューティングや監査証跡として利用する。                                                                                                       |
| **バリデーション** | 入力されたデータが、定義された規則（必須、データ型、文字数、形式など）に適合しているかを検証すること。Accessの機能（テーブルレベル、フォームレベル）やVBAで実装する。                                                                |
| **イレギュラー** | データ転記処理（4.4項）において、ステージングDBの内容を顧客Excel管理表に書き戻す際に発生する予期せぬ状況（対象セルの上書き、行削除、キー重複など）。                                                                         |
| **エスカレーション** | イレギュラー発生時に、メンバーが手動確認や管理者への報告を行うプロセス。                                                                                                                                 |
| **DI (Dependency Injection)** | 依存性の注入。クラスが必要とする外部オブジェクトを内部で生成するのではなく、外部から渡す設計パターン。テスト容易性や再利用性を向上させるため、**【設計原則とパターン (VBA版)】** に基づき可能な範囲で考慮する。                                |
| **モックオブジェクト** | DIを用いるテストにおいて、依存する本物のオブジェクトの代わりに使用するテスト用のダミーオブジェクト。**【テスト戦略とガイドライン (VBA版)】** で推奨される。                                                                        |

---

## 3. システム概要

### 3.1 システム構成

* 本システムは **Microsoft Access** を用いて開発・運用します。
* アプリケーションは、ユーザーインターフェースを提供する**フロントエンド(FE)** と、データを格納する **バックエンド(BE)** に分離した構成（FE/BE分離構成）を採用します。これは**【設計原則とパターン (VBA版)】** に基づき、保守性、拡張性、およびデータ破損リスクの低減を目的とします。
    * **FE:** 各メンバーのPCに配布または共有フォルダから実行。フォーム、レポート、UI制御VBA、プレゼンテーションロジックを含む。
    * **BE:** アクセス権が適切に管理された共有フォルダ等に配置し、FEからリンクテーブル等で接続。テーブル、クエリ、リレーションシップ、データアクセスロジック（必要に応じて）を含む。
* BEデータベース内には、作業用の一時データ領域として **ステージングDB（テーブル群）** を設けます。コピーExcel管理表からインポートされたデータはこのステージングDBに格納され、メンバーの作業対象となります。

### 3.2 データ処理フロー

本システムの基本的なデータ処理フローは以下の通りです。

1.  **準備:** メンバーは作業開始前に、最新の「顧客Excel管理表」を所定の場所にコピーして「コピーExcel管理表」を作成します（必要に応じてコピー支援機能を提供、4.1項参照）。
2.  **データ取込:** メンバーは本システム(FE)を起動し、「データ取込」機能を選択します。指定した「コピーExcel管理表」からデータが読み込まれ、BE内の「ステージングDB」にインポートされます。この際、システム独自の「独自キー」が付与され、データクレンジングが行われます（4.1項参照）。取込処理のログが記録されます。
3.  **作業:** メンバーは本システム(FE)上のAccessフォームを使用し、「ステージングDB」に対してデータの参照、入力、更新、照合等の作業を行います（4.2項参照）。入力された作業履歴も、独自キーで案件データと紐づけられた上でステージングDB内の関連テーブルに記録されます（4.3項参照）。
4.  **データ転記:** 作業完了後、メンバーは本システム(FE)の「データ転記」機能を選択します。「ステージングDB」上の更新されたデータ（または必要な差分データ）が、元の「顧客Excel管理表」に書き戻されます（4.4項参照）。転記処理中にイレギュラー（7.2項参照）が検知された場合、該当データはスキップされ、エスカレーション用のレポート（CSV形式）が出力されます。転記処理のログも記録されます。
5.  **完了・エスカレーション:** 転記処理の完了を確認します。イレギュラーレポートが出力された場合は、メンバーはその内容を確認し、手動での確認・修正や管理者へのエスカレーション（メール等）を行います。

### 3.3 運用環境

* 本システムは、オンプレミスの社内ネットワーク環境内で完結させます（個人情報の外部持ち出し禁止）。
* BEデータベースファイルは、アクセス権が適切に管理された共有フォルダ等に配置します。
* リモートワーク環境からは、VPN等を経由して共有フォルダ上のBEファイルにアクセス可能とします。ネットワーク不安定性によるパフォーマンス影響やエラー発生の可能性を考慮した設計（エラーハンドリング、タイムアウト設定等）を行います（5.2項、5.3項参照）。

---

## 4. 機能要件

本システムが提供する主要な機能を以下に定義します。実装にあたっては**【標準ドキュメント群】**に準拠します。

### 4.1 データ取込・準備機能

* **Excelコピー支援 (任意):** 最新の顧客Excel管理表を安全にコピーするためのガイド表示や、ファイル選択ダイアログ、簡易的なコピーコマンド実行などの支援機能。誤操作防止を目的とします（必須要件ではない）。
* **ステージングDBへのインポート:**
    * メンバーが指定したコピーExcel管理表からデータを読み込み、BE内のステージングDB（専用テーブル群）にインポートする機能。
    * **データクレンジング:** インポート処理実行時に、データの基本的なクレンジング（例: 前後の空白トリム、全角/半角統一など、定義されたルールに基づく）や、Accessテーブル定義に合わせたデータ型の変換を可能な範囲で行う。
    * **独自キー採番:** インポートする案件データに対し、システム独自の「独自キー」を採番・付与し、ステージングDBに格納する。過去データとの紐づけが必要な場合のロジック（例: 既存キーとのマッチング）も考慮する（詳細は別途設計）。
    * **差分インポート（検討）:** 大量データの場合、前回インポート時からの差分のみを取り込む機能の実現可能性を検討する。
    * **インポートログ:** インポート処理の実行日時、対象ファイル名、処理件数、成功/失敗ステータス、エラー発生件数、エラー内容（データ型不一致、必須項目欠落など）をBE内のログテーブルに記録する機能。エラー発生時はユーザーにも通知する。
    * **エラーハンドリング:** インポート中のファイルアクセスエラー、シート/列名の不一致、データ型変換エラーなどを**【設計原則とパターン (VBA版)】**に基づき適切に処理し、処理を安全に中断または継続（可能な場合）し、ログに記録する。

### 4.2 入力フォーム機能 (Accessフォーム)

* **顧客情報参照・絞り込み:**
    * ステージングDB内の顧客・案件データを一覧表示（連続フォーム、データシートビュー等）し、キーワード検索（部分一致、前方一致）、複数条件（日付範囲、ステータス等）による絞り込みが可能なAccessフォーム。
    * **書類照合支援:** 紙媒体やPDF等の書類との目視照合をしやすくするため、フォーム上の項目配置や表示順を書類レイアウトに近づける、関連情報をグループ化する等の工夫を行う。
    * **表示パフォーマンス:** 大量データ表示時のパフォーマンスに配慮し、必要なデータのみをロードする、適切なインデックスを利用する等の対策を検討する（5.2項参照）。
* **作業情報の記録:**
    * 選択した案件に対し、「着手日時」「完了日時」「担当者（ログインユーザー情報から自動セット、変更可）」「作業内容区分」「作業ステータス」「備考」等を、選択肢（コンボボックス、リストボックス）やテキスト入力により記録できるAccessフォーム（単票フォーム形式）。
    * 入力された作業情報は、ステージングDB内の作業履歴関連テーブルに、案件データと**独自キー**で紐づく形で保存される。
* **入力バリデーション:**
    * **【コーディング規約 (VBA版)】** に基づき、以下のバリデーションをAccessフォームのコントロールレベル、またはVBA、テーブルレベルで実装する。
        * 必須項目の入力チェック (`Required`プロパティ、VBAでのチェック)。
        * 日付形式チェック (`IsDate`関数等)。
        * 数値形式チェック (`IsNumeric`関数、入力規則等)。
        * 文字数制限（コントロールのプロパティ、VBA）。
        * 選択肢以外の値の入力制限（コンボボックスの`LimitToList`プロパティ）。
        * その他、業務ルールに基づくカスタムバリデーション（VBA）。
    * バリデーションエラー発生時は、ユーザーに分かりやすいメッセージ（エラー内容、修正箇所）を表示し、該当コントロールにフォーカスを移動させるなどのフィードバックを行う。
* **UIデザインとアクセシビリティ:**
    * **【デザイン参照用CSS】** の思想に基づき、以下のアクセシビリティ要件を満たすようにフォームを設計する（詳細は 5.4項 参照）。
        * **配色とコントラスト:** 背景色（例: `--persol-white`）、文字色（例: `--color-text-primary`=`--persol-dark-gray`）、アクセント色（例: `--persol-teal`）は十分なコントラスト比を確保する。
        * **フォント:** 読みやすいフォント（例: `--font-primary` 指定の`Meiryo UI`等）を適切なサイズ（例: `--font-size-md`相当）で使用する。
        * **ラベル:** 各コントロールには、内容を示す明確なラベル (`Label`コントロール) を関連付ける。必要に応じて`ControlTipText`プロパティで補足説明を追加する。
        * **キーボード操作:** すべての操作がキーボードのみで完結できるように、タブオーダー (`TabIndex`) を論理的な順序に設定し、アクセスキー (`Caption`内の`&`文字) やショートカットキーを適切に割り当てる。
        * **レイアウト:** 情報のグループ化、適切な余白（CSSの`--space-*`の考え方を参考に）により、視覚的な分かりやすさを向上させる。

### 4.3 リレーション管理機能

* **独自キーによる紐付け:** ステージングDB内において、「案件情報テーブル」と「作業履歴テーブル」などをシステムが付与した**独自キー**によって関連付ける。Accessのリレーションシップ機能（参照整合性含む）やクエリを活用して実装する。
* **リレーション維持:** この独自キーによる紐付けにより、元の顧客Excel管理表側でキー情報（行番号や顧客が付与したIDなど）が変動した場合でも、システムに記録済みの作業履歴と案件情報との関連性が維持されることを保証する。

### 4.4 データ転記機能

* **ステージングDBからExcelへの書き戻し:**
    * メンバーの指示に基づき、ステージングDB内の作業結果（更新された案件情報、作業ステータス、完了日時等）を、元の「顧客Excel管理表」の該当箇所に転記（既存Excelファイルを更新）する機能。
    * **転記ロジック:** 具体的な転記ロジックは「7.2 データ転記ロジック」の方針に従う。更新対象セルを特定し、通常は空欄の場合のみ転記。イレギュラー（上書き、削除、キー重複など）を検知した場合は転記をスキップし、ログとレポートに出力する。
    * **ファイルロック確認:** 転記処理実行前に、対象となる顧客Excel管理表が他のユーザーによって編集中（ロックされている）でないかを確認する仕組みを導入する（VBAでのファイルオープン試行等）。ロック中の場合は、リトライするか、ユーザーに通知して処理を中断する。
    * **エラーハンドリング:** 転記中のファイルアクセスエラー、Excelオブジェクト操作エラー、データ不整合などを**【設計原則とパターン (VBA版)】**に基づき適切に処理し、ログに記録する。
    * **転記ログ:** 転記処理の実行日時、対象ファイル名、転記件数、スキップ件数（イレギュラー発生時）、エラー発生状況等をBE内のログテーブルに記録する機能。
    * **エスカレーションレポート出力:** イレギュラー発生時に、どのデータの転記がスキップされたかを特定できる情報（独自キー、顧客名、スキップ理由、元のExcelの行/列情報など）を含むレポートをCSV形式等で生成し、メンバーに提示する機能。

### 4.5 ダッシュボード・集計機能

* **作業状況の可視化:** Accessのレポート機能やクエリを活用し、ステージングDB内のデータから以下の情報を表示する機能（必要に応じてグラフ表示も検討）。
    * 担当者別、案件別の作業進捗状況一覧（ステータス、未完了件数など）。
    * 期間別（日次、週次、月次）、ステータス別の作業完了件数集計。
    * 作業種別ごとの件数や平均処理時間の集計（可能であれば）。
    * その他、業務管理上必要となる統計情報。
* **メンバー個人向け表示:** ログインユーザー（または選択したユーザー）自身の担当案件一覧、作業履歴、未完了タスクなどを容易に確認できる専用のフォームまたはレポート。

---

## 5. 非機能要件

本システムが満たすべき品質特性や制約事項を以下に定義します。実装にあたっては**【標準ドキュメント群】**に準拠します。

### 5.1 セキュリティ

* **データ保管:** 個人情報を含む顧客Excel管理表、コピーExcel管理表、および本システムのBEデータベースは、社内ネットワーク環境から外部に持ち出さない構成（オンプレミス運用）とする。
* **アクセス制御:** BEデータベースファイルが格納される共有フォルダへのアクセス権限は、OSまたはファイルサーバーの機能を用いて、許可されたメンバーおよび管理者のみがアクセスできるように適切に管理する。
* **アプリケーション認証 (任意):** 必要に応じて、本システム(FE)起動時にWindows認証情報を利用する、または簡易的なユーザー認証（パスワード等、ただし管理が必要）を行う機能の導入を検討する。
* **VBAコード保護:** FEファイル（.accdbまたは.accde）内のVBAコードにはパスワードを設定し、意図しない閲覧や変更を防止する。

### 5.2 パフォーマンス

* **応答性:**
    * データ取込、入力フォーム表示（特に検索・絞り込み時）、データ転記等の主要な処理が、想定される最大データ量（例: 数万件レコード）において、実用的な応答時間（例: フォーム表示・検索は数秒以内、データ取込・転記はデータ量に応じて許容範囲内、目安として数分以内）で完了することを目指す。
    * 大量データを扱うフォームでは、必要なデータのみを取得するクエリ設計、適切なインデックス設定、非同期処理の検討（Accessの機能範囲内で）などを行う。
* **共有フォルダ利用時の考慮:**
    * 共有フォルダ上のBEファイルへのアクセスは、ネットワーク帯域や遅延によってパフォーマンスが変動する可能性があることを考慮する。
    * クエリの最適化（サーバーサイドでの処理を促す設計等）、リンクテーブルの効率的な利用、ローカルでの一時的なデータキャッシュ（必要な場合）などの対策を検討する。
    * **【設計原則とパターン (VBA版)】** の「長時間処理に関する考慮事項」に基づき、処理中のUIフリーズを避けるため、進捗表示や `DoEvents` の適切な使用（ただし、副作用に注意）を検討する。

### 5.3 可用性・信頼性

* **安定稼働:** 複数メンバーによる同時利用（FEは各PC、BEは共有）環境下で、システムが安定して動作すること。 Accessのレコードロック競合が発生しにくい設計（例: データ編集フォームを限定する、非接続型レコードセットの使用検討など）を考慮する。
* **データ整合性:**
    * FE/BE分離構成、ステージングDBの利用、Accessのリレーションシップ機能（参照整合性）、適切なバリデーションにより、データの不整合が発生しにくい設計とする。
    * トランザクション処理（`BeginTrans`, `CommitTrans`, `Rollback`）を、複数のテーブル更新が伴う重要な処理（例: 案件情報と作業履歴の同時更新）に適用し、処理の原子性を確保する。
* **エラー耐性:**
    * **【設計原則とパターン (VBA版)】** および **【コーディング規約 (VBA版)】** に基づく堅牢なエラーハンドリング (`On Error GoTo Label`, `ErrorHandler:`, `CleanExit:`パターン) をすべてのプロシージャに実装する。
    * データ取込・転記処理中の予期せぬエラー（ファイルアクセス不可、データ形式不正、ネットワーク切断、Excelオブジェクトエラー等）発生時にも、システムが異常終了せず、エラー内容を詳細にログ記録し、ユーザーに状況を通知し、可能な限り安全な状態（データ不整合を起こさない状態）で処理を中断または復帰（リソース解放含む）するよう実装する。
* **ファイル破損リスク低減:** FE/BE分離構成により、ユーザー操作によるFEファイルの破損がBEのデータ本体に影響を与えるリスクを低減する。BEファイルの定期的な最適化と修復の運用を推奨する（6.1項参照）。

### 5.4 操作性・アクセシビリティ

* **ユーザーインターフェース (UI) 設計:** **障害**者を含む多様なメンバーが利用することを前提とし、**【デザイン参照用CSS】(persol-universal-manual.css)** のユニバーサルデザイン思想をAccessフォーム設計の指針とする。直感的で分かりやすく、学習しやすい画面設計を心がける。
    * **配色とコントラスト:**
        * 文字色（例: `--color-text-primary` = `#53565a`）、背景色（例: `--color-background-primary` = `#ffffff`）、主要な対話要素（ボタン、選択項目など）は、WCAG 2.1 AAレベル以上のコントラスト比（4.5:1以上、大きな文字は3:1以上）を確保するよう、Accessのカラーパレットを設定する。
        * ステータス表示（成功、警告、エラー）には、色だけでなくアイコンやテキストラベルを併用し、色覚多様性に配慮する（例: `--color-success`, `--color-warning`, `--color-danger` の色を参考にしつつ、アイコン等を追加）。
        * CSSの `--persol-teal`, `--persol-blue` などのアクセントカラーを、視覚的な区別や強調のために適切に使用する。
    * **フォントとサイズ:**
        * 読みやすさに定評のあるフォント（例: CSSの `--font-primary` 指定にある `Meiryo UI` や `メイリオ` など、システムにインストールされているもの）をデフォルトフォントとして使用する。
        * 基準となるフォントサイズ（例: CSSの `--font-size-md` = `16pt` を目安）を設定し、読みやすさを確保する。必要に応じてユーザーが拡大できるように、OSの機能との連携も考慮する。
    * **レイアウトと視覚的階層:**
        * CSSのレイアウト思想（例: `layout-procedure` のような情報分割、`--space-*` のような余白設定）を参考に、関連する情報をグループ化し、コントロール間の適切な間隔を確保し、視覚的な階層を明確にする。
        * 画面上の情報を詰め込みすぎず、シンプルで見やすいレイアウトを心がける。
* **キーボード操作:**
    * マウス操作が困難なメンバーのため、**すべての機能がキーボードのみで操作可能**であること。
    * フォーム内のコントロール間の移動順序（タブオーダー、`TabIndex`プロパティ）を、左上から右下へ、または論理的なグループ単位で自然な順序に設定する。
    * 主要なボタンや機能には、アクセスキー (`Caption`プロパティ内の `&`文字) やショートカットキーを割り当てる。
* **ラベルと説明:**
    * すべての入力コントロール（テキストボックス、コンボボックス等）には、対応するラベル (`Label`コントロール) を明確に関連付ける（ラベルのクリックでコントロールにフォーカスが移動するように）。
    * ラベルのテキストは、コントロールの目的を簡潔かつ明確に示すものとする。
    * 必要に応じて、コントロールの`ControlTipText`プロパティを使用して、マウスホバー時やスクリーンリーダー利用時に補足的な説明や入力例が表示されるように設定する。
* **スクリーンリーダーへの配慮:** ラベルの適切な設定、論理的なタブオーダー、標準的なAccessコントロールの使用により、スクリーンリーダー（PC-Talker, NVDA等）での基本的な読み上げに対応できるように配慮する。（完全な対応はAccessの制約もあるため、ベストエフォートとする）。
* **フィードバック:** 操作の結果（成功、エラー、処理中など）は、ステータスバー、メッセージボックス、視覚的な変化（色、アイコン）などでユーザーに明確にフィードバックする。エラーメッセージは具体的で分かりやすい表現にする。

---

## 6. 運用要件

本システムの導入・運用に関する要件を以下に定義します。

### 6.1 運用体制

* 本システムの運用管理を担当する管理者（主担当および副担当）を定めます。
* 管理者は、BEファイルのメンテナンス（定期的な最適化と修復）、共有フォルダのアクセス権管理、ユーザー管理（必要に応じて）、トラブルシューティング、バックアップ管理、手順書の更新等を担当します。

### 6.2 バックアップ

* BEデータベースファイルは、ファイルサーバーのバックアップ機能等を利用し、**定期的（例: 毎日差分/増分、毎週フル）かつ複数世代**（例: 過去14日分）のバックアップを取得する。
* バックアップからのリストア手順を確立し、定期的に（例: 半年に一度）テストを実施し、手順の有効性を確認する。

### 6.3 ユーザーサポート

* メンバーからの問い合わせ（操作方法、エラー発生時の対応など）に対応する窓口（ヘルプデスク、担当部署など）を明確にする。
* **本システムの操作手順書**を作成し、メンバーに配布・周知する。手順書には以下の内容を含む。
    * システムの起動・終了方法
    * Excel原本からのコピー手順
    * データ取込の手順と注意点
    * 各入力フォームの操作方法、入力ルール
    * データ転記の手順と注意点
    * イレギュラー発生時の確認方法とエスカレーション手順
    * よくある質問（FAQ）とトラブルシューティング
* **障害**を持つメンバーに対する個別サポート体制（操作説明、代替手段の提供検討など）についても検討し、必要に応じて手順書に追記する。

### 6.4 Excel管理表との連携ルール

* **原本管理:** 「顧客Excel管理表」の原本ファイル（マスターデータ）の保管場所（特定の共有フォルダパス）と管理責任者を明確にする。原本ファイルへの直接編集は原則禁止とする。
* **コピータイミングと手順:** メンバーが作業を開始する際の、「顧客Excel管理表」から「コピーExcel管理表」を作成する具体的なタイミング（例: 毎作業開始時）と手順（ファイル名の命名規則含む）を定め、手順書に明記する。
* **転記タイミングとルール:** 「データ転記」機能の実行タイミング（例: 各メンバーが自身の作業完了都度、または1日の終わりにまとめて）と、実行責任者に関するルールを定める。複数メンバーが同時に転記を試みる場合の調整ルールも検討する。
* **転記後ファイルの扱い:** データ転記後の「顧客Excel管理表」（更新された原本）の版管理方法（例: 日付やバージョン番号を付与して履歴保管）や、使用済みの「コピーExcel管理表」の扱い（削除、一定期間保管後に削除等）に関するルールを定める。

---

## 7. 方針決定事項（改修版）

本セクションでは、標準ドキュメント群とCSSテーマの分析を踏まえ、現時点で決定した主要な方針を明記します。

### 7.1 Access構成

* **方針決定:** アプリケーションの保守性、拡張性、データ保護、および **【テスト戦略とガイドライン (VBA版)】** で推奨されるテスト容易性の観点から、**フロントエンド(FE)とバックエンド(BE)を分離した構成を採用します。**
* **補足:** FEは各ユーザー環境で実行し、BEは共有フォルダで一元管理します。これにより、FEの破損がデータ本体(BE)に影響するリスクを低減し、BEの集中管理（バックアップ、アクセス制御）を容易にします。FEの配布・更新方法（共有フォルダからのショートカット、手動コピーなど）は別途定めます。

### 7.2 データ転記ロジック（ステージングDB → 顧客Excel管理表）

* **方針決定:** データ転記機能（機能要件 4.4）の具体的なロジックは以下を基本方針とします。
    * **更新対象の特定:** メンバー作業により更新されるべきExcelセル（通常、本システムでの作業対象項目に対応する列）を特定します。キー項目（独自キーに対応するExcel上の列）を用いて、ステージングDBのレコードとExcelの行を紐付けます。
    * **通常処理:** 紐付けられたExcel行において、更新対象セルが空欄（または事前に定義した初期値、例: "未入力"）の場合のみ、ステージングDBの値をExcelに転記します。
    * **イレギュラー検知:** 以下の状況をイレギュラーとして検知した場合、該当データの転記は行わず、スキップします。
        * **予期せぬ上書き:** 更新対象セルに、空欄や初期値以外の予期せぬ値が既に存在する場合。
        * **行/列の削除:** 転記対象のレコードに対応するExcel上の行、または更新対象の列が見つからない場合。
        * **キー項目の一意性喪失:** Excel上でキー項目が重複している場合（例: 行のコピー＆ペーストによる）。
    * **エスカレーション:** イレギュラー検知時は、スキップしたデータの詳細情報（独自キー、顧客名、Excel行番号、スキップ理由、対象列、ステージングDBの値、Excel上の値など）を特定できる**レポート（CSV形式）を生成**し、利用者に提示します。利用者はレポート内容を確認し、手動での確認・修正や管理者への**メール等でのエスカレーション**を実施します。

### 7.3 エラーハンドリング

* **方針決定:** システム全体の堅牢性を確保するため、**【設計原則とパターン (VBA版)】** および **【コーディング規約 (VBA版)】** に準拠した、一貫性のあるエラーハンドリングを実装します。
    * **基本構造:** すべてのエラーが発生しうるプロシージャには `On Error GoTo ErrorHandlerLabel` を記述します。
    * **エラー処理:** `ErrorHandler:` ラベル以下で、`Err`オブジェクト（`Number`, `Description`, `Source`）を参照し、エラー情報を取得・記録します。
    * **リソース解放:** `CleanExit:` ラベル（または類似のパターン）を設け、エラー発生有無に関わらず実行すべきリソース解放処理（オブジェクト変数の`Set Nothing`、ファイルクローズ等）を確実に実行します。`ErrorHandler:` からは `Resume CleanExit` でジャンプします。
    * **ログ記録:** エラー発生時には、エラー情報（日時、エラー番号、内容、発生プロシージャ、関連データ等）をBEのログテーブルに記録します。ユーザーへのフィードバックも適切に行います。
    * **`On Error Resume Next` の制限:** この構文の使用は、ファイル存在確認など、エラーが想定され無視できる場合に限定し、使用直後に`Err`オブジェクトのチェックを行うか、`On Error GoTo 0`/`Label`でエラー処理を戻します。

### 7.4 同時利用シナリオ

* **方針決定:** FE/BE分離構成とステージングDB利用により、複数メンバーが同時に作業しても、ステージングDB上での直接的なデータ競合リスクは低減されます。
    * **Excel転記時の競合:** データ転記（4.4項）時の顧客Excel管理表ファイルへのアクセス競合については、まずファイルがロックされていないか確認します。ロック中の場合は、ユーザーに通知し、リトライや処理中断を選択できるようにします。
    * **Accessのロック:** BEデータベース（Accessファイル）への同時アクセスに関しては、Accessの組み込みのレコードロック/ページロック機構に基本的に依存します。ただし、ロック競合が頻発しないような設計（例: フォームでのデータ保持時間を短くする、非接続レコードセットの検討）を心がけます。
    * **ネットワーク不安定性:** リモートアクセス時のネットワーク不安定性によるファイルアクセスエラー等は、堅牢なエラーハンドリング（7.3項）で対応し、処理の中断やデータの不整合を防ぎます。

### 7.5 パフォーマンスチューニング

* **方針決定:** 初期開発段階では過度な最適化は行わず、標準的なベストプラクティス（適切なインデックス設定、効率的なクエリ作成、`With`ステートメント利用など）を適用します。**実データを用いたテストフェーズや運用開始後にボトルネックが顕在化した場合に、優先度を付けて対応します。**

### 7.6 アクセシビリティ要件の詳細化

* **方針決定:** ユニバーサルデザインを意識し、**【デザイン参照用CSS】(persol-universal-manual.css)** の設計思想を参考に、**障害**者を含む多様なメンバーにとって利用しやすいUIをAccessフォーム上で可能な限り実現します。具体的な指針は非機能要件（5.4項）に詳述しますが、特に以下を重視します。
    * **配色・コントラスト:** CSSで定義された主要な色（`--persol-white`, `--persol-dark-gray`, `--persol-teal`等）を参考に、十分なコントラスト比を確保した配色をAccessフォームのプロパティで設定します。
    * **フォント:** CSS指定の `Meiryo UI` 等、可読性の高いフォントを選択し、適切なサイズを設定します。
    * **キーボード操作性:** タブオーダーの論理的な設定、アクセスキー/ショートカットキーの活用により、全ての操作をキーボードのみで完結できるようにします。
    * **ラベルと説明:** 各コントロールに明確なラベルを付与し、必要に応じて`ControlTipText`等で補足説明を追加します。
    * **スクリーンリーダー:** 上記の対応により、スクリーンリーダーでの基本的な利用に配慮します（ベストエフォート）。
* **今後の活動:** 開発フェーズ中に、**障害**を持つメンバーを含むユーザーによるユーザビリティテストを計画・実施し、フィードバックを反映させることを検討します。

### 7.7 将来的なM365環境への移行

* **方針決定:** 将来的なMicrosoft 365 (E3ライセンス等) 環境への移行（Power Platform等の活用）も視野に入れますが、**現行システム開発における優先度は低く設定します。**
* **設計上の配慮:** 移行の可能性を考慮し、過度にAccess特有の機能や複雑なVBAマクロに依存しすぎない、比較的シンプルで汎用的なデータ構造（正規化されたテーブル設計）、モジュール化されたコード設計（**【設計原則とパターン (VBA版)】** のクラスベース設計、DIの考慮）を心がけます。

---

## 8. 参考情報・関連資料

* 既存Excel管理表の構造サンプル（別途提供）
* 現行業務マニュアル、チェックリスト等（別途提供）
* 過去の入力履歴、エラー発生事例に関するレポート（あれば）
* ユーザー要望ヒアリング結果（あれば）
* **【標準ドキュメント群】**
    * AI開発者向けガイド (VBA版)
    * コーディング規約 (VBA版)
    * 設計原則とパターン (VBA版)
    * テスト戦略とガイドライン (VBA版)
* **【デザイン参照用CSS】**
    * CSSテーマ「persol-universal-manual」 (UIデザイン/アクセシビリティ思想の参考資料)

---

## 9. 承認・今後のステップ

本書（改修版）の内容について、関係者間でレビューを行い、合意形成を図ります。承認後、本書および**【標準ドキュメント群】**を基に以下の次ステップに進みます。

1.  **基本設計:**
    * BE: Access テーブル詳細設計（フィールド定義、データ型、主キー、外部キー、インデックス、リレーションシップ定義）
    * BE: 主要クエリ設計（データ取得、更新用）
    * FE: Access フォーム・レポート画面設計（レイアウト、コントロール定義、アクセシビリティ配慮事項の具体化）
    * FE/BE: 主要VBAロジック設計（データ取込処理、データ転記処理、エラーハンドリング共通処理、主要なビジネスロジック）
    * ログ設計（ログテーブル構造、記録項目）
    * エスカレーションレポート設計（出力フォーマット、項目）
2.  **詳細設計・実装:** 基本設計に基づき、詳細な仕様を決定し、**【標準ドキュメント群】**に準拠して開発を開始します。
3.  **テスト:** **【テスト戦略とガイドライン (VBA版)】**に基づき、以下のテストを実施します。
    * 単体テスト（VBAプロシージャ、クラスモジュール単位、可能な範囲でモックを使用）
    * 結合テスト（FE-BE連携、データ取込・転記フロー）
    * 総合テスト（シナリオベースでの機能確認、パフォーマンステスト）
    * 受け入れテスト（ユーザーによる操作確認、アクセシビリティテスト含む）
4.  **導入・運用準備:** 最終版手順書の作成、ユーザーへのトレーニング、運用体制の整備。
5.  **運用開始:**

---

**以上**